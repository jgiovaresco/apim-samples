= apim samples

image:https://img.shields.io/badge/vert.x-4.3.6-purple.svg[link="https://vertx.io"]

This application provide API sample that I use to play with https://github.com/gravitee-io/gravitee-api-management[Gravite APIM].

== Building

To launch your tests:
----
./gradlew clean test
----

To run your application:
----
./gradlew clean run
----

== Configuration

Configuration is provided through environment variables. Available variables are defined
link:app/src/main/kotlin/io/apim/samples/Configuration.kt[here]

[,java]
----
include::app/src/main/kotlin/io/apim/samples/Configuration.kt[lines=2..]
----

== Available endpoints

It starts 2 http servers

- one used to handle regular HTTP request. (default port 8888)
- one used to handle WebSockets. (default port 8890)

=== HTTP /echo

This HTTP endpoint can receive HTTP request. It will copy the request received in a 200 response.

==== Example

Using https://httpie.io/cli[httpie]:
----
http POST http://localhost:8888/echo\?qs\=value message=Hello
----

will respond

[source,json]
----
{
    "body": {
        "message": "Hello"
    },
    "headers": {
        "Accept": "application/json, */*;q=0.5",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Content-Length": "20",
        "Content-Type": "application/json",
        "Host": "localhost:8888",
        "User-Agent": "HTTPie/3.2.1"
    },
    "method": "POST",
    "query_params": {
        "qs": "value"
    }
}
----

=== WebSocket /ws/echo

This HTTP endpoint can receive HTTP request. It will copy the request received in a 200 response.

==== Example

Using https://github.com/vi/websocat[websocat]:
----
websocat -1 ws://localhost:8890/ws/echo
{"message": "Hello"}
----

will respond

[source,json]
----
{
  "type": "json",
  "request": {
    "message": "Hello"
  }
}
----
